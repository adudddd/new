<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Coastal Defense</title>
  <style>
    /* ===== Reset & Basic Styles ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      transition: all 0.3s ease;
    }
    body {
      background: #e6f7ff;
      overflow: hidden;
      position: relative;
      height: 100vh;
    }
    /* ===== Start Screen ===== */
    #startScreen {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #4fa8e0, #87CEEB);
      color: #fff;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      animation: fadeIn 1s;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    #startScreen h1 {
      margin-bottom: 20px;
      font-size: 2.5em;
      text-align: center;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    #startScreen p {
      margin-bottom: 30px;
      font-size: 1.2em;
      text-align: center;
      max-width: 80%;
      line-height: 1.4;
    }
    #startScreen button {
      padding: 12px 30px;
      font-size: 1.2em;
      border: none;
      border-radius: 5px;
      background: #ffcc00;
      color: #333;
      cursor: pointer;
      box-shadow: 0px 4px 6px rgba(0,0,0,0.2);
    }
    #startScreen button:hover {
      background: #ffdd33;
    }
    /* ===== Game Area ===== */
    #gameArea {
      position: relative;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: linear-gradient(to bottom, #87CEEB, #e6f7ff);
    }
    /* ===== Coastal Background ===== */
    .ocean {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 40%;
      background: linear-gradient(to bottom, #4fa8e0, #1e5799);
      z-index: 1;
    }
    .beach {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 80px;
      background: linear-gradient(to bottom, #f2d694, #e6c88a);
      z-index: 2;
    }
    .house {
      position: absolute;
      bottom: 80px;
      left: 10%;
      width: 100px;
      height: 80px;
      background: #ffd1dc;
      border: 3px solid #d38c9f;
      border-radius: 10px;
      z-index: 3;
    }
    /* ===== Player ===== */
    #player {
      position: absolute;
      bottom: 100px;
      left: 50%;
      width: 40px;
      height: 60px;
      background: #00aced;
      border: 2px solid #000;
      border-radius: 5px;
      z-index: 10;
    }
    /* ===== Resources ===== */
    .resource {
      position: absolute;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: gold;
      cursor: pointer;
      z-index: 5;
    }
    /* ===== Attack Animations ===== */
    .melee-attack {
      position: absolute;
      width: 20px;
      height: 20px;
      background: red;
      border-radius: 50%;
      z-index: 15;
      animation: meleeSwing 0.5s;
    }
    @keyframes meleeSwing {
      0% { transform: rotate(0deg); }
      50% { transform: rotate(90deg); }
      100% { transform: rotate(0deg); }
    }
    .ranged-attack {
      position: absolute;
      width: 10px;
      height: 10px;
      background: blue;
      border-radius: 50%;
      z-index: 15;
      animation: shoot 1s linear;
    }
    @keyframes shoot {
      0% { transform: translateX(0); }
      100% { transform: translateX(200px); }
    }
    .special-attack {
      position: absolute;
      width: 50px;
      height: 50px;
      background: yellow;
      border-radius: 50%;
      z-index: 15;
      animation: explode 1s;
    }
    @keyframes explode {
      0% { transform: scale(0); }
      50% { transform: scale(1); }
      100% { transform: scale(0); }
    }
    /* ===== Alien Styles & Animations ===== */
    .alien {
      position: absolute;
      border-radius: 50%;
      z-index: 8;
    }
    .alien-drone {
      width: 40px;
      height: 40px;
      background-color: limegreen;
      border: 2px solid #0a0;
      animation: float 2s infinite;
    }
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    .alien-shielded {
      width: 60px;
      height: 60px;
      background-color: deepskyblue;
      border: 2px solid #08f;
      animation: pulseShield 3s infinite;
    }
    @keyframes pulseShield {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .alien-elite {
      width: 80px;
      height: 80px;
      background-color: red;
      border: 2px solid #800;
      animation: teleport 5s infinite;
    }
    @keyframes teleport {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0; transform: scale(0.5); }
    }
    .alien-boss {
      width: 120px;
      height: 120px;
      background-color: purple;
      border: 2px solid #600;
      animation: bossCharge 10s infinite;
    }
    @keyframes bossCharge {
      0% { transform: translateX(0); }
      50% { transform: translateX(100px); }
      100% { transform: translateX(0); }
    }
    /* ===== HUD ===== */
    #hud {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 20;
      color: #000;
      font-size: 1.2em;
      background: rgba(255,255,255,0.8);
      padding: 5px 10px;
      border-radius: 5px;
    }
    #messages {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 20;
      background: rgba(0,0,0,0.7);
      color: #fff;
      padding: 10px;
      border-radius: 5px;
      font-size: 1em;
    }
  </style>
</head>
<body>
  <!-- Start Screen -->
  <div id="startScreen">
    <h1>Welcome to Coastal Defense!</h1>
    <p>Protect your home from alien invaders. Collect resources, upgrade your weapons, and survive the waves!</p>
    <button id="startButton">Start Game</button>
  </div>
  
  <!-- Game Area -->
  <div id="gameArea">
    <div class="ocean"></div>
    <div class="beach"></div>
    <div class="house" id="house"></div>
    <div id="player"></div>
    <div id="hud">
      Health: <span id="playerHealth">100</span> | Wave: <span id="waveNumber">0</span> | Resources: <span id="resources">0</span>
    </div>
    <div id="messages"></div>
  </div>
  
  <script>
    // ===== Utility Functions =====
    function random(min, max) {
      return Math.random() * (max - min) + min;
    }
    
    // ===== Alien Class =====
    class Alien {
      constructor(type, x, y) {
        this.type = type;
        this.health = (type === 'boss') ? 300 : 100;
        this.element = document.createElement('div');
        this.element.classList.add('alien', `alien-${type}`);
        this.x = x;
        this.y = y;
        this.speed = (type === 'drone') ? 0.5 : (type === 'shielded') ? 0.3 : (type === 'elite') ? 0.7 : 0.2;
        this.element.style.left = `${this.x}px`;
        this.element.style.top = `${this.y}px`;
        document.getElementById('gameArea').appendChild(this.element);
      }
      
      update() {
        // Move alien toward player's house (for simplicity, move left)
        this.x -= this.speed;
        this.element.style.left = `${this.x}px`;
      }
      
      remove() {
        this.element.remove();
      }
    }
    
    // ===== Game Class =====
    class Game {
      constructor() {
        this.player = document.getElementById('player');
        this.hudHealth = document.getElementById('playerHealth');
        this.hudWave = document.getElementById('waveNumber');
        this.hudResources = document.getElementById('resources');
        this.messageBox = document.getElementById('messages');
        this.house = document.getElementById('house');
        this.playerHealth = 100;
        this.resources = 0;
        this.wave = 0;
        this.aliens = [];
        this.attackHistory = [];
        this.gameLoopInterval = null;
        this.alienSpawnInterval = null;
        this.initControls();
      }
      
      startGame() {
        // Hide start screen with fade-out effect
        const startScreen = document.getElementById('startScreen');
        startScreen.style.opacity = 0;
        setTimeout(() => { startScreen.style.display = 'none'; }, 500);
        this.showMessage("Wave 1 incoming! Prepare for battle!");
        this.nextWave();
        this.gameLoopInterval = setInterval(() => this.update(), 20);
        this.alienSpawnInterval = setInterval(() => this.spawnAlien(), 2000);
      }
      
      initControls() {
        // Player movement (arrow keys / WASD) and attacks
        document.addEventListener('keydown', (e) => {
          let left = parseInt(window.getComputedStyle(this.player).left);
          let bottom = parseInt(window.getComputedStyle(this.player).bottom);
          switch(e.key) {
            case 'ArrowLeft': case 'a': this.player.style.left = (left - 10) + 'px'; break;
            case 'ArrowRight': case 'd': this.player.style.left = (left + 10) + 'px'; break;
            case 'ArrowUp': case 'w': this.player.style.bottom = (bottom + 10) + 'px'; break;
            case 'ArrowDown': case 's': this.player.style.bottom = (bottom - 10) + 'px'; break;
            case 'j': this.playerAttack('melee'); break;
            case 'k': this.playerAttack('ranged'); break;
            case 'l': this.playerAttack('special'); break;
          }
        });
      }
      
      playerAttack(type) {
        this.attackHistory.push(type);
        let attackElem = document.createElement('div');
        let pRect = this.player.getBoundingClientRect();
        attackElem.style.position = 'absolute';
        attackElem.style.left = (pRect.left + 20) + 'px';
        attackElem.style.top = (pRect.top + 20) + 'px';
        if (type === 'melee') {
          attackElem.classList.add('melee-attack');
        } else if (type === 'ranged') {
          attackElem.classList.add('ranged-attack');
        } else if (type === 'special') {
          attackElem.classList.add('special-attack');
        }
        document.getElementById('gameArea').appendChild(attackElem);
        setTimeout(() => { attackElem.remove(); }, 600);
        this.checkAttackCollisions(type);
      }
      
      checkAttackCollisions(attackType) {
        this.aliens.forEach((alien, index) => {
          let alienRect = alien.element.getBoundingClientRect();
          let playerRect = this.player.getBoundingClientRect();
          if (Math.abs(alienRect.left - playerRect.left) < 50 && Math.abs(alienRect.top - playerRect.top) < 50) {
            alien.health -= (attackType === 'melee' ? 30 : attackType === 'ranged' ? 20 : 50);
            if (alien.health <= 0) {
              this.destroyAlien(index);
              this.resources += 5;
              this.updateHUD();
            }
          }
        });
      }
      
      destroyAlien(index) {
        this.aliens[index].remove();
        this.aliens.splice(index, 1);
      }
      
      spawnAlien() {
        let type = 'drone';
        if (this.attackHistory.filter(a => a==='melee').length > 5) {
          type = (Math.random() < 0.5) ? 'shielded' : 'drone';
        }
        if (this.wave >= 5 && Math.random() < 0.2) {
          type = (Math.random() < 0.5) ? 'elite' : 'boss';
        }
        let x = window.innerWidth;
        let y = random(50, window.innerHeight - 150);
        let alien = new Alien(type, x, y);
        this.aliens.push(alien);
      }
      
      update() {
        this.aliens.forEach(alien => alien.update());
        this.aliens.forEach((alien, index) => {
          let houseRect = this.house.getBoundingClientRect();
          let alienRect = alien.element.getBoundingClientRect();
          if (alienRect.left < houseRect.right) {
            this.playerHealth -= 10;
            this.updateHUD();
            this.showMessage("Your house is under attack! Repair it quickly!");
            this.destroyAlien(index);
            if(this.playerHealth <= 0) {
              this.gameOver();
            }
          }
        });
      }
      
      updateHUD() {
        this.hudHealth.textContent = this.playerHealth;
        this.hudWave.textContent = this.wave;
        this.hudResources.textContent = this.resources;
      }
      
      nextWave() {
        this.wave++;
        this.updateHUD();
        this.showMessage(`Wave ${this.wave} incoming! Prepare for battle!`);
        clearInterval(this.alienSpawnInterval);
        this.alienSpawnInterval = setInterval(() => this.spawnAlien(), Math.max(500, 2000 - this.wave * 100));
      }
      
      showMessage(msg) {
        this.messageBox.textContent = msg;
        this.messageBox.style.opacity = 1;
        setTimeout(() => { this.messageBox.style.opacity = 0; }, 3000);
      }
      
      gameOver() {
        clearInterval(this.gameLoopInterval);
        clearInterval(this.alienSpawnInterval);
        this.showMessage("Game over! The aliens have taken over. Refresh to try again.");
      }
    }
    
    // Instantiate game
    let game = new Game();
    
    // Attach event listener to start button
    document.getElementById('startButton').addEventListener('click', () => {
      game.startGame();
    });
  </script>
</body>
</html>
