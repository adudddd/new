<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Coastal Defense Retro</title>
  <!-- Retro pixel font -->
  <link href="https://fonts.googleapis.com/css?family=Press+Start+2P" rel="stylesheet">
  <style>
    /* Global Reset */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Press Start 2P', cursive;
      background-color: #000;
      overflow: hidden;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    /* Parallax Starfield Background */
    #starfield {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -2;
      background: radial-gradient(ellipse at center, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.95) 100%);
    }
    /* Game Container with CRT effects and 3D border */
    #gameContainer {
      position: relative;
      width: 800px;
      height: 600px;
      background: linear-gradient(to bottom, #000033, #0066cc);
      border: 4px solid #fff;
      box-shadow: 0 0 20px #00ff00, inset 0 0 15px #00ff0044;
      overflow: hidden;
      filter: blur(0.5px) contrast(110%);
    }
    /* CRT Overlay: scanlines, radial gradient, and flicker animation */
    #crtOverlay {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      z-index: 99;
      background: repeating-linear-gradient(
          to bottom,
          transparent,
          transparent 1px,
          rgba(0, 0, 0, 0.5) 1px,
          rgba(0, 0, 0, 0.5) 2px
        ),
        radial-gradient(ellipse at center, rgba(255,255,255,0.1), transparent);
      animation: crtFlicker 5s infinite;
    }
    @keyframes crtFlicker {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.995; }
    }
    /* HUD Styles */
    #hud {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      z-index: 100;
      pointer-events: none;
    }
    #scoreDisplay {
      position: absolute;
      top: 10px; left: 10px;
      font-size: 20px;
      text-shadow: 2px 2px #000;
    }
    /* Health bar styled as segmented LED lights */
    #healthBar {
      position: absolute;
      bottom: 10px; left: 10px;
      width: 200px; height: 30px;
      display: flex;
    }
    .healthSegment {
      flex: 1;
      margin: 1px;
      background-color: red;
      border: 1px solid #fff;
    }
    /* Critical health pulsating border effect */
    .critical {
      animation: pulseBorder 1s infinite;
    }
    @keyframes pulseBorder {
      0% { box-shadow: 0 0 20px #ff0000, inset 0 0 15px #ff000044; }
      50% { box-shadow: 0 0 40px #ff0000, inset 0 0 30px #ff000044; }
      100% { box-shadow: 0 0 20px #ff0000, inset 0 0 15px #ff000044; }
    }
    /* Mini-map indicator (placeholder) */
    #miniMap {
      position: absolute;
      top: 10px; right: 10px;
      width: 150px; height: 100px;
      background: rgba(0, 0, 0, 0.5);
      border: 2px solid #00ff00;
      z-index: 101;
      overflow: hidden;
      font-size: 8px;
      padding: 5px;
    }
    /* Player Ship: CSS Triangle + Rectangle combo with thruster */
    .playerShip {
      position: absolute;
      bottom: 20px;
      left: 375px;
      width: 0;
      height: 0;
      border-left: 25px solid transparent;
      border-right: 25px solid transparent;
      border-bottom: 50px solid #fff;
      z-index: 50;
    }
    .thruster {
      position: absolute;
      top: 50px;
      left: -10px;
      width: 50px;
      height: 20px;
      background: orange;
      opacity: 0.8;
      animation: thrusterPulse 0.5s infinite alternate;
    }
    @keyframes thrusterPulse {
      0% { transform: scaleY(0.8); }
      100% { transform: scaleY(1.2); }
    }
    /* Enemy Designs */
    .enemy.basic {
      position: absolute;
      font-size: 30px;
      color: lime;
      text-shadow: 0 0 10px lime;
      z-index: 40;
    }
    .enemy.advanced {
      position: absolute;
      width: 40px; height: 40px;
      z-index: 40;
    }
    .enemy.boss {
      position: absolute;
      width: 120px; height: 120px;
      background: purple;
      border: 2px solid #fff;
      z-index: 30;
    }
    /* Bullet Style: bright yellow dash with trail */
    .bullet {
      position: absolute;
      width: 5px; height: 20px;
      background: yellow;
      box-shadow: 0 0 10px yellow;
      z-index: 60;
    }
    /* Floating score indicators */
    .scoreIndicator {
      position: absolute;
      color: #0f0;
      font-size: 16px;
      animation: floatUp 1s ease-out forwards;
      pointer-events: none;
    }
    @keyframes floatUp {
      0% { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(-30px); }
    }
    /* Start Screen */
    #startScreen {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.9);
      z-index: 200;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
    }
    #startScreen h1 {
      font-size: 48px;
      text-shadow: 3px 3px #00ff00, -3px -3px #00ff00;
      margin-bottom: 20px;
    }
    #startScreen button {
      font-size: 24px;
      padding: 10px 20px;
      background: #00ff00;
      border: 2px solid #fff;
      cursor: pointer;
    }
    /* Pause Menu */
    #pauseMenu {
      position: absolute;
      top: 20%;
      left: 20%;
      width: 60%;
      height: 60%;
      background: rgba(0, 128, 0, 0.7);
      border: 4px solid #fff;
      display: none;
      z-index: 150;
      text-align: center;
      padding-top: 50px;
      font-size: 24px;
    }
    /* Game Over Screen */
    #gameOverScreen {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.9);
      display: none;
      z-index: 200;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    #gameOverScreen h1 {
      font-size: 48px;
      margin-bottom: 20px;
    }
    #gameOverScreen p {
      font-size: 24px;
      animation: blink 1s infinite;
    }
    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }
    /* Power-up Indicator (example icon) */
    #powerUpBar {
      position: absolute;
      bottom: 50px; right: 10px;
      display: flex;
      flex-direction: column;
      gap: 5px;
      z-index: 110;
    }
    .powerUpIcon {
      width: 30px; height: 30px;
      background: rgba(0,255,255,0.7);
      border: 2px solid #fff;
    }
  </style>
</head>
<body>
  <!-- Starfield Background -->
  <div id="starfield"></div>
  <!-- Game Container -->
  <div id="gameContainer">
    <!-- CRT Overlay -->
    <div id="crtOverlay"></div>
    <!-- HUD -->
    <div id="hud">
      <div id="scoreDisplay">Score: 0</div>
      <div id="healthBar">
        <div class="healthSegment"></div>
        <div class="healthSegment"></div>
        <div class="healthSegment"></div>
        <div class="healthSegment"></div>
        <div class="healthSegment"></div>
        <div class="healthSegment"></div>
        <div class="healthSegment"></div>
        <div class="healthSegment"></div>
        <div class="healthSegment"></div>
        <div class="healthSegment"></div>
      </div>
    </div>
    <!-- Mini-map -->
    <div id="miniMap">Mini-map</div>
    <!-- Player Ship -->
    <div class="playerShip">
      <div class="thruster"></div>
    </div>
    <!-- Power-up Bar -->
    <div id="powerUpBar">
      <div class="powerUpIcon"></div>
      <div class="powerUpIcon"></div>
    </div>
    <!-- Start Screen -->
    <div id="startScreen">
      <h1>COASTAL DEFENSE</h1>
      <p>Press Enter or click the button to start</p>
      <button id="startButton">Start Game</button>
    </div>
    <!-- Pause Menu -->
    <div id="pauseMenu">
      <h1>Paused</h1>
      <p>Press P to resume</p>
    </div>
    <!-- Game Over Screen -->
    <div id="gameOverScreen">
      <h1>Game Over</h1>
      <p>INSERT COIN</p>
      <button id="restartButton">Restart</button>
    </div>
  </div>

  <script>
    // ===== Global Variables & Setup =====
    const gameContainer = document.getElementById('gameContainer');
    const startScreen = document.getElementById('startScreen');
    const startButton = document.getElementById('startButton');
    const pauseMenu = document.getElementById('pauseMenu');
    const gameOverScreen = document.getElementById('gameOverScreen');
    const restartButton = document.getElementById('restartButton');
    const scoreDisplay = document.getElementById('scoreDisplay');
    const healthSegments = document.querySelectorAll('.healthSegment');
    const miniMap = document.getElementById('miniMap');
    const playerShip = document.querySelector('.playerShip');
    
    let score = 0;
    let playerHealth = 100;
    let enemies = [];
    let bullets = [];
    let gameInterval, enemySpawnInterval, bulletInterval;
    let gamePaused = false;
    
    // ===== HUD & Feedback Functions =====
    function updateScore(newScore) {
      score = newScore;
      scoreDisplay.textContent = 'Score: ' + score;
      // Floating +10 indicator
      const indicator = document.createElement('div');
      indicator.className = 'scoreIndicator';
      indicator.style.left = '50px';
      indicator.style.top = '20px';
      indicator.textContent = '+10';
      gameContainer.appendChild(indicator);
      setTimeout(() => indicator.remove(), 1000);
    }
    
    function updateHealth(health) {
      playerHealth = health;
      let segmentsToFill = Math.ceil((health / 100) * 10);
      healthSegments.forEach((seg, index) => {
        seg.style.backgroundColor = index < segmentsToFill ? 'red' : '#333';
      });
      if (health < 30) {
        gameContainer.classList.add('critical');
      } else {
        gameContainer.classList.remove('critical');
      }
    }
    
    // Red flash on damage
    function flashDamage() {
      gameContainer.style.transition = 'background 0.1s';
      gameContainer.style.background = 'red';
      setTimeout(() => {
        gameContainer.style.background = 'linear-gradient(to bottom, #000033, #0066cc)';
      }, 100);
    }
    
    // Screen shake effect
    function screenShake() {
      gameContainer.style.animation = 'shake 0.5s';
      setTimeout(() => gameContainer.style.animation = '', 500);
    }
    // Inject shake keyframes
    const styleSheet = document.styleSheets[0];
    styleSheet.insertRule(`@keyframes shake {
      0% { transform: translate(0, 0); }
      25% { transform: translate(5px, 5px); }
      50% { transform: translate(-5px, -5px); }
      75% { transform: translate(5px, -5px); }
      100% { transform: translate(0, 0); }
    }`, styleSheet.cssRules.length);
    
    // Bullet impact spark effect
    function createSpark(x, y) {
      const spark = document.createElement('div');
      spark.style.position = 'absolute';
      spark.style.left = x + 'px';
      spark.style.top = y + 'px';
      spark.style.width = '10px';
      spark.style.height = '10px';
      spark.style.borderRadius = '50%';
      spark.style.background = 'yellow';
      spark.style.opacity = '1';
      spark.style.zIndex = 80;
      gameContainer.appendChild(spark);
      spark.animate([{ transform: 'scale(0)', opacity: 1 }, { transform: 'scale(1.5)', opacity: 0 }], { duration: 300, fill: 'forwards' });
      setTimeout(() => spark.remove(), 300);
    }
    
    // Floating damage number
    function createDamageNumber(x, y, damage) {
      const dmgNum = document.createElement('div');
      dmgNum.style.position = 'absolute';
      dmgNum.style.left = x + 'px';
      dmgNum.style.top = y + 'px';
      dmgNum.style.fontSize = '20px';
      dmgNum.style.color = '#ff0';
      dmgNum.style.textShadow = '2px 2px #000';
      dmgNum.textContent = '-' + damage;
      dmgNum.classList.add('scoreIndicator');
      gameContainer.appendChild(dmgNum);
      setTimeout(() => dmgNum.remove(), 1000);
    }
    
    // Enemy death ASCII explosion
    function enemyDeathAnimation(enemy) {
      const explosion = document.createElement('div');
      explosion.style.position = 'absolute';
      explosion.style.left = enemy.style.left;
      explosion.style.top = enemy.style.top;
      explosion.style.fontSize = '30px';
      explosion.style.color = '#fff';
      explosion.style.textShadow = '0 0 5px #ff0';
      explosion.textContent = '✸★✹';
      gameContainer.appendChild(explosion);
      explosion.animate([{ opacity: 1 }, { opacity: 0 }], { duration: 500, fill: 'forwards' });
      setTimeout(() => explosion.remove(), 500);
    }
    
    // ===== Dynamic Background Animation =====
    function animateStarfield() {
      const starfield = document.getElementById('starfield');
      let offset = 0;
      setInterval(() => {
        offset += 0.5;
        starfield.style.backgroundPosition = offset + 'px ' + offset + 'px';
      }, 50);
    }
    animateStarfield();
    
    // ===== Enemy Creation & Movement =====
    function createEnemy(variant = 'basic') {
      const enemy = document.createElement('div');
      enemy.classList.add('enemy');
      enemy.dataset.variant = variant;
      if (variant === 'basic') {
        enemy.classList.add('basic');
        enemy.textContent = '▾';
      } else if (variant === 'advanced') {
        enemy.classList.add('advanced');
        enemy.innerHTML = '<svg width="40" height="40"><ellipse cx="20" cy="20" rx="20" ry="10" fill="red" /><line x1="5" y1="10" x2="15" y2="0" stroke="black" stroke-width="2"/><line x1="25" y1="0" x2="35" y2="10" stroke="black" stroke-width="2"/></svg>';
      } else if (variant === 'boss') {
        enemy.classList.add('boss');
        const bossHealth = document.createElement('div');
        bossHealth.style.position = 'absolute';
        bossHealth.style.bottom = '-10px';
        bossHealth.style.left = '0';
        bossHealth.style.width = '100%';
        bossHealth.style.height = '5px';
        bossHealth.style.background = 'green';
        enemy.appendChild(bossHealth);
      }
      enemy.style.left = Math.random() * (gameContainer.clientWidth - 50) + 'px';
      enemy.style.top = '0px';
      gameContainer.appendChild(enemy);
      enemies.push(enemy);
      moveEnemy(enemy);
    }
    
    function moveEnemy(enemy) {
      let enemyTop = 0;
      const moveInterval = setInterval(() => {
        enemyTop += 2;
        enemy.style.top = enemyTop + 'px';
        if (enemyTop > gameContainer.clientHeight) {
          enemy.remove();
          clearInterval(moveInterval);
        }
      }, 50);
    }
    
    // ===== Shooting: Bullet Creation & Movement =====
    function createBullet() {
      const bullet = document.createElement('div');
      bullet.className = 'bullet';
      let playerRect = playerShip.getBoundingClientRect();
      let containerRect = gameContainer.getBoundingClientRect();
      let bulletX = playerRect.left - containerRect.left + (playerRect.width / 2) - 2.5;
      bullet.style.left = bulletX + 'px';
      bullet.style.bottom = '70px';
      gameContainer.appendChild(bullet);
      bullets.push(bullet);
      moveBullet(bullet);
    }
    
    function moveBullet(bullet) {
      let bulletBottom = 70;
      const interval = setInterval(() => {
        bulletBottom += 5;
        bullet.style.bottom = bulletBottom + 'px';
        detectBulletCollision(bullet);
        if (bulletBottom > gameContainer.clientHeight) {
          bullet.remove();
          clearInterval(interval);
        }
      }, 20);
    }
    
    function detectBulletCollision(bullet) {
      enemies.forEach((enemy, index) => {
        const bulletRect = bullet.getBoundingClientRect();
        const enemyRect = enemy.getBoundingClientRect();
        if (!(bulletRect.right < enemyRect.left ||
              bulletRect.left > enemyRect.right ||
              bulletRect.bottom < enemyRect.top ||
              bulletRect.top > enemyRect.bottom)) {
          createSpark(parseInt(bullet.style.left), parseInt(bullet.style.bottom));
          createDamageNumber(parseInt(enemy.style.left), parseInt(enemy.style.top), 10);
          updateScore(score + 10);
          enemyDeathAnimation(enemy);
          enemy.remove();
          enemies.splice(index, 1);
          bullet.remove();
        }
      });
    }
    
    // ===== Keyboard Controls =====
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') {
        let currentLeft = parseInt(playerShip.style.left);
        playerShip.style.left = Math.max(0, currentLeft - 10) + 'px';
      }
      if (e.key === 'ArrowRight') {
        let currentLeft = parseInt(playerShip.style.left);
        playerShip.style.left = Math.min(gameContainer.clientWidth - 50, currentLeft + 10) + 'px';
      }
      if (e.code === 'Space') { createBullet(); }
      if ((e.key === 'Enter' || e.key === 'Return') && startScreen.style.display !== 'none') {
        startGame();
      }
      if (e.key.toLowerCase() === 'p') { togglePause(); }
    });
    
    // ===== Game Control Functions =====
    function startGame() {
      startScreen.style.display = 'none';
      updateHealth(100);
      gameInterval = setInterval(() => {
        // Random enemy spawns
        if (Math.random() < 0.03) { createEnemy('basic'); }
        if (Math.random() < 0.01) { createEnemy('advanced'); }
        if (Math.random() < 0.001) { createEnemy('boss'); }
      }, 100);
    }
    
    function togglePause() {
      gamePaused = !gamePaused;
      if (gamePaused) {
        clearInterval(gameInterval);
        pauseMenu.style.display = 'block';
      } else {
        pauseMenu.style.display = 'none';
        startGame();
      }
    }
    
    restartButton.addEventListener('click', () => location.reload());
    startButton.addEventListener('click', startGame);
    
    // ===== Easter Egg: Konami Code =====
    let konamiCode = [38,38,40,40,37,39,37,39,66,65];
    let konamiIndex = 0;
    document.addEventListener('keydown', (e) => {
      if (e.keyCode === konamiCode[konamiIndex]) {
        konamiIndex++;
        if (konamiIndex === konamiCode.length) {
          activateEasterEgg();
          konamiIndex = 0;
        }
      } else { konamiIndex = 0; }
    });
    
    function activateEasterEgg() {
      gameContainer.style.background = 'linear-gradient(45deg, #8e44ad, #3498db, #e74c3c)';
    }
    
    // (Optional) For testing: flash damage and screen shake on timeout
    // setTimeout(() => { flashDamage(); updateHealth(20); }, 5000);
    // setTimeout(() => { screenShake(); }, 7000);
    
  </script>
</body>
</html>
